
# ChaiLove
SOURCES_CXX += $(wildcard \
	src/*.cpp \
	src/chailove/*.cpp \
	test/*.cpp \
	src/chailove/graphics/*.cpp \
	src/chailove/input/*.cpp \
	src/chailove/audio/*.cpp \
	src/chailove/system/*.cpp \
)
FLAGS += -Ivendor

# filesystem
FLAGS += -Ivendor/filesystem

# libretro-common
FLAGS += -I../RetroArch/libretro-common/include
SOURCES_C += $(wildcard \
	../RetroArch/libretro-common/lists/*.c \
	../RetroArch/libretro-common/features/*.c \
	../RetroArch/libretro-common/file/file_path.c \
	../RetroArch/libretro-common/file/retro_dirent.c \
	../RetroArch/libretro-common/file/config_file.c \
	../RetroArch/libretro-common/file/config_file_userdata.c \
	../RetroArch/libretro-common/memmap/memalign.c \
	../RetroArch/libretro-common/streams/file_stream.c \
	../RetroArch/libretro-common/formats/wav/*.c \
	../RetroArch/libretro-common/audio/audio_mix.c \
	../RetroArch/libretro-common/audio/audio_mixer.c \
	../RetroArch/libretro-common/audio/resampler/*.c \
	../RetroArch/libretro-common/audio/resampler/drivers/*.c \
	../RetroArch/libretro-common/audio/conversion/*.c \
	../RetroArch/libretro-common/compat/*.c \
	../RetroArch/libretro-common/hash/*.c \
	../RetroArch/libretro-common/vfs/*.c \
)

#	vendor/libretro-common/file/*.c \
#	vendor/libretro-common/streams/*.c \
#	vendor/libretro-common/formats/libchdr/*.c \


# libFLAC
#FLAGS += -Ivendor/deps/libFLAC/include
#SOURCES_C += $(wildcard \
#	vendor/deps/libFLAC/*.c \
#)

# libogg
#FLAGS += -Ivendor/deps/libogg/include
#SOURCES_C += $(wildcard \
#	vendor/deps/libogg/src/*.c \
#)

# libz
#FLAGS += -Ivendor/deps/libz
#SOURCES_C += $(wildcard \
#	vendor/deps/libz/*.c \
#)
#FLAGS += -DWANT_ZLIB -DZ_SOLO

# 7zip
#FLAGS += -Ivendor/deps/lib7z
#SOURCES_C += $(wildcard \
#	vendor/deps/lib7z/*.c \
#)

# PhysFS
FLAGS += -Ivendor/physfs/src
FLAGS += -Ivendor/physfs/extras
FLAGS += -DPHYSFS_NO_CDROM_SUPPORT=1
SOURCES_C += $(wildcard \
	vendor/physfs/extras/physfsrwops.c \
	vendor/physfs/src/*.c \
)

# SDL_tty
FLAGS += -Ivendor/SDL_tty/include
SOURCES_C += $(wildcard \
	vendor/SDL_tty/src/SDL_tty.c \
	vendor/SDL_tty/src/SDL_fnt.c \
)

# SDL_gfx
FLAGS += -Ivendor/sdl-libretro/tests/SDL_gfx-2.0.26
SOURCES_C += $(wildcard \
	vendor/sdl-libretro/tests/SDL_gfx-2.0.26/*.c \
)

# SDL_ttf
# TODO Fix TTF Support https://github.com/RobLoach/ChaiLove/issues/48
#FLAGS += -Ivendor/sdl-libretro/tests/SDL_ttf-2.0.11/VisualC/external/include
#SOURCES_C += $(wildcard \
#	vendor/sdl-libretro/tests/SDL_ttf-2.0.11/*.c \
#)

# SDL_stbimage
FLAGS += -Ivendor/Snippets

# STB
FLAGS += -Ivendor/stb

# ChaiScript
ifeq ($(HAVE_CHAISCRIPT),)
	FLAGS += -Ivendor/chaiscript/include
	FLAGS += -Ivendor/RobLoachChaiScript_Extras/include
	FLAGS += -D__HAVE_CHAISCRIPT__
	FLAGS += -DCHAISCRIPT_NO_THREADS -DCHAISCRIPT_NO_THREADS_WARNING -DCHAISCRIPT_NO_DYNLOAD
	FLAGS += -DCHAISCRIPT_EXTRAS_MATH_DISABLE_ISINF -DCHAISCRIPT_EXTRAS_MATH_DISABLE_ISNAN
endif

# SDL
ifeq ($(platform), win)
	SOURCES_C += $(wildcard ./vendor/sdl-libretro/src/*.c  ./vendor/sdl-libretro/src/audio/*.c  ./vendor/sdl-libretro/src/cdrom/dummy/*.c  ./vendor/sdl-libretro/src/cdrom/*.c  ./vendor/sdl-libretro/src/cpuinfo/*.c  ./vendor/sdl-libretro/src/events/*.c  ./vendor/sdl-libretro/src/file/*.c  ./vendor/sdl-libretro/src/stdlib/*.c  ./vendor/sdl-libretro/src/thread/*.c  ./vendor/sdl-libretro/src/timer/*.c  ./vendor/sdl-libretro/src/video/*.c  ./vendor/sdl-libretro/src/joystick/*.c  ./vendor/sdl-libretro/src/video/libretro/*.c  ./vendor/sdl-libretro/src/joystick/libretro/*.c  ./vendor/sdl-libretro/src/timer/libretro/*.c  ./vendor/sdl-libretro/src/audio/libretro/*.c  ./vendor/sdl-libretro/src/thread/win32/SDL_sysmutex.c ./vendor/sdl-libretro/src/thread/win32/SDL_syssem.c ./vendor/sdl-libretro/src/thread/win32/SDL_systhread.c ./vendor/sdl-libretro/src/thread/generic/SDL_syscond.c ./vendor/sdl-libretro/src/loadso/dummy/*.c)
else
	SOURCES_C += $(wildcard ./vendor/sdl-libretro/src/*.c ./vendor/sdl-libretro/src/audio/*.c  ./vendor/sdl-libretro/src/cdrom/dummy/*.c  ./vendor/sdl-libretro/src/cdrom/*.c  ./vendor/sdl-libretro/src/cpuinfo/*.c  ./vendor/sdl-libretro/src/events/*.c  ./vendor/sdl-libretro/src/file/*.c  ./vendor/sdl-libretro/src/stdlib/*.c  ./vendor/sdl-libretro/src/thread/*.c  ./vendor/sdl-libretro/src/timer/*.c  ./vendor/sdl-libretro/src/video/*.c  ./vendor/sdl-libretro/src/joystick/*.c  ./vendor/sdl-libretro/src/video/libretro/*.c  ./vendor/sdl-libretro/src/thread/generic/*.c ./vendor/sdl-libretro/src/joystick/libretro/*.c  ./vendor/sdl-libretro/src/timer/libretro/*.c  ./vendor/sdl-libretro/src/audio/libretro/*.c  ./vendor/sdl-libretro/src/loadso/dummy/*.c)
endif
FLAGS += -DSDL_THREADS_DISABLED -DSDL_CDROM_DISABLED
FLAGS += -Ivendor/sdl-libretro/include


OBJECTS += $(SOURCES_CXX:.cpp=.o) $(SOURCES_C:.c=.o)

# Build all the dependencies, and the core.
all: | dependencies	$(TARGET)

ifeq ($(DEBUG), 0)
   FLAGS += -O3 -ffast-math -fomit-frame-pointer
else
   FLAGS += -O0 -g
endif

LDFLAGS +=  $(fpic) $(SHARED) $(EXTRA_LDF)

WARNINGS :=

ifneq ($(HAVE_TESTS),)
	FLAGS += -D__HAVE_TESTS__
endif
